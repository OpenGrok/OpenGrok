# This references an OpenJDK container from the
# Docker Hub https://hub.docker.com/_/openjdk/
box: openjdk:8-jdk

# This should switch to Oracle JDK however does not work:
#box:
#  id: store/oracle/serverjre
#  username: $DOCKER_USERNAME
#  password: $DOCKER_PASSWORD
#  tag: 8

build:
  steps:
    - install-packages:
      packages: sudo maven exuberant-ctags cvs git mercurial cssc bzr subversion monotone rcs pep8
    - script:
      name: Maven install
      code: |
        /usr/sbin/groupadd -g 1000 foobar
        /usr/sbin/useradd -u 1000 -g 1000 -s /bin/bash -m foobar
        echo $WERCKER_ROOT > /tmp/wroot
        chown -R foobar:foobar $WERCKER_ROOT
        /usr/bin/sudo -i -u foobar -- bash -c 'cd `cat /tmp/wroot`; /usr/bin/mvn verify'

# Ideally this should support running under non-root user:
#    # https://github.com/wercker/step-maven
#    - wercker/maven:
#      goals: install
#      cache_repo: true
#      version: 3.5.2
